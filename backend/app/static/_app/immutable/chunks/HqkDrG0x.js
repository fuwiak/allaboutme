import{S as We,i as je,s as Be,n as be,d as f,D as qe,b as J,I as Ie,c as j,e as i,l as ke,f as d,g as u,h as v,k as M,m as T,j as ie,o as h,q as x,t as N,B as Ae,P as He}from"./DDZ0vrLm.js";import{e as De}from"./DsHVYrMn.js";import"./IHki7fMi.js";import{t as Oe}from"./BuSLZ8y9.js";function Ue(o,e,t){const s=`ws://localhost:8000/ws/progress/${o}`,l=new WebSocket(s);return l.onopen=()=>{console.log(`WebSocket connected for task: ${o}`)},l.onmessage=r=>{try{const n=JSON.parse(r.data);e(n),(n.status==="completed"||n.status==="failed")&&setTimeout(()=>l.close(),1e3)}catch(n){console.error("Error parsing WebSocket message:",n)}},l.onerror=r=>{console.error("WebSocket error:",r),t&&t(r)},l.onclose=()=>{console.log(`WebSocket closed for task: ${o}`)},l}function Me(o,e,t){const s=o.slice();return s[14]=e[t],s}function xe(o){let e;return{c(){e=h("div"),this.h()},l(t){e=u(t,"DIV",{class:!0}),v(e).forEach(f),this.h()},h(){d(e,"class","animate-spin rounded-full h-6 w-6 border-b-2 border-purple-500")},m(t,s){j(t,e,s)},d(t){t&&f(e)}}}function Pe(o){let e,t=o[14]+"",s;return{c(){e=h("div"),s=N(t),this.h()},l(l){e=u(l,"DIV",{class:!0});var r=v(e);s=T(r,t),r.forEach(f),this.h()},h(){d(e,"class","hover:bg-gray-800/50 px-2 py-1 rounded")},m(l,r){j(l,e,r),i(e,s)},p(l,r){r&32&&t!==(t=l[14]+"")&&J(s,t)},d(l){l&&f(e)}}}function Ve(o){let e,t="Waiting for updates...";return{c(){e=h("div"),e.textContent=t,this.h()},l(s){e=u(s,"DIV",{class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-1h4wqyt"&&(e.textContent=t),this.h()},h(){d(e,"class","text-gray-500 text-center py-8")},m(s,l){j(s,e,l)},d(s){s&&f(e)}}}function Te(o){let e,t,s;function l(a,b){return a[7]?ze:Le}let r=l(o),n=r(o);return{c(){e=h("button"),n.c(),this.h()},l(a){e=u(a,"BUTTON",{class:!0});var b=v(e);n.l(b),b.forEach(f),this.h()},h(){e.disabled=o[7],d(e,"class","px-6 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors")},m(a,b){j(a,e,b),n.m(e,null),t||(s=ke(e,"click",o[12]),t=!0)},p(a,b){r===(r=l(a))&&n?n.p(a,b):(n.d(1),n=r(a),n&&(n.c(),n.m(e,null))),b&128&&(e.disabled=a[7])},d(a){a&&f(e),n.d(),t=!1,s()}}}function Le(o){let e,t=o[8]("common.stop")+"",s;return{c(){e=N("⏹️ "),s=N(t)},l(l){e=T(l,"⏹️ "),s=T(l,t)},m(l,r){j(l,e,r),j(l,s,r)},p(l,r){r&256&&t!==(t=l[8]("common.stop")+"")&&J(s,t)},d(l){l&&(f(e),f(s))}}}function ze(o){let e,t,s,l=o[8]("common.cancelling")+"",r;return{c(){e=h("span"),t=h("div"),s=x(),r=N(l),this.h()},l(n){e=u(n,"SPAN",{class:!0});var a=v(e);t=u(a,"DIV",{class:!0}),v(t).forEach(f),s=M(a),r=T(a,l),a.forEach(f),this.h()},h(){d(t,"class","animate-spin rounded-full h-4 w-4 border-b-2 border-white"),d(e,"class","flex items-center gap-2")},m(n,a){j(n,e,a),i(e,t),i(e,s),i(e,r)},p(n,a){a&256&&l!==(l=n[8]("common.cancelling")+"")&&J(r,l)},d(n){n&&f(e)}}}function Ne(o){let e,t="Close",s,l;return{c(){e=h("button"),e.textContent=t,this.h()},l(r){e=u(r,"BUTTON",{class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-15mws22"&&(e.textContent=t),this.h()},h(){d(e,"class","px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg transition-colors")},m(r,n){j(r,e,n),s||(l=ke(e,"click",o[9]),s=!0)},p:be,d(r){r&&f(e),s=!1,l()}}}function Je(o){let e,t,s,l,r,n,a,b,E,A='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',H,_,S,D,B,F,g,W,X=Math.floor(o[4])+"",Z,ae,ce,G,O,fe,U,Y=Math.round(o[2])+"",$,de,ue,q,L,we="Detailed Progress:",he,P,ee,ge,V,te,pe,ye,y=!o[6]&&xe(),K=De(o[5]),m=[];for(let c=0;c<K.length;c+=1)m[c]=Pe(Me(o,K,c));let C=o[5].length===0&&Ve(),k=!o[6]&&o[1]&&Te(o),w=o[6]&&Ne(o);return{c(){e=h("div"),t=h("div"),s=h("div"),l=h("div"),y&&y.c(),r=x(),n=h("h2"),a=N(o[0]),b=x(),E=h("button"),E.innerHTML=A,H=x(),_=h("div"),S=h("div"),D=h("div"),B=h("span"),F=N(o[3]),g=x(),W=h("span"),Z=N(X),ae=N("s elapsed"),ce=x(),G=h("div"),O=h("div"),fe=x(),U=h("div"),$=N(Y),de=N("%"),ue=x(),q=h("div"),L=h("h3"),L.textContent=we,he=x(),P=h("div");for(let c=0;c<m.length;c+=1)m[c].c();ee=x(),C&&C.c(),ge=x(),V=h("div"),k&&k.c(),te=x(),w&&w.c(),this.h()},l(c){e=u(c,"DIV",{class:!0});var I=v(e);t=u(I,"DIV",{class:!0});var p=v(t);s=u(p,"DIV",{class:!0});var z=v(s);l=u(z,"DIV",{class:!0});var le=v(l);y&&y.l(le),r=M(le),n=u(le,"H2",{class:!0});var Ce=v(n);a=T(Ce,o[0]),Ce.forEach(f),le.forEach(f),b=M(z),E=u(z,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ie(E)!=="svelte-edacne"&&(E.innerHTML=A),z.forEach(f),H=M(p),_=u(p,"DIV",{class:!0});var Q=v(_);S=u(Q,"DIV",{class:!0});var R=v(S);D=u(R,"DIV",{class:!0});var se=v(D);B=u(se,"SPAN",{class:!0});var Ee=v(B);F=T(Ee,o[3]),Ee.forEach(f),g=M(se),W=u(se,"SPAN",{class:!0});var ve=v(W);Z=T(ve,X),ae=T(ve,"s elapsed"),ve.forEach(f),se.forEach(f),ce=M(R),G=u(R,"DIV",{class:!0});var Se=v(G);O=u(Se,"DIV",{class:!0,style:!0}),v(O).forEach(f),Se.forEach(f),fe=M(R),U=u(R,"DIV",{class:!0});var _e=v(U);$=T(_e,Y),de=T(_e,"%"),_e.forEach(f),R.forEach(f),ue=M(Q),q=u(Q,"DIV",{class:!0});var oe=v(q);L=u(oe,"H3",{class:!0,"data-svelte-h":!0}),ie(L)!=="svelte-170owwq"&&(L.textContent=we),he=M(oe),P=u(oe,"DIV",{class:!0});var re=v(P);for(let me=0;me<m.length;me+=1)m[me].l(re);ee=M(re),C&&C.l(re),re.forEach(f),oe.forEach(f),ge=M(Q),V=u(Q,"DIV",{class:!0});var ne=v(V);k&&k.l(ne),te=M(ne),w&&w.l(ne),ne.forEach(f),Q.forEach(f),p.forEach(f),I.forEach(f),this.h()},h(){d(n,"class","text-xl font-bold text-white"),d(l,"class","flex items-center gap-3"),d(E,"class","text-gray-400 hover:text-white transition-colors"),d(E,"title","Close modal"),d(s,"class","flex items-center justify-between p-6 border-b border-gray-700"),d(B,"class","text-gray-300"),d(W,"class","text-gray-400"),d(D,"class","flex justify-between text-sm"),d(O,"class","bg-gradient-to-r from-purple-500 to-blue-500 h-full transition-all duration-300 ease-out"),Ie(O,"width",o[2]+"%"),d(G,"class","w-full bg-gray-700 rounded-full h-3 overflow-hidden"),d(U,"class","text-right text-sm text-gray-400"),d(S,"class","space-y-2"),d(L,"class","text-sm font-semibold text-gray-300"),d(P,"class","bg-black/50 rounded-lg p-4 h-64 overflow-y-auto font-mono text-xs text-gray-300 space-y-1"),d(q,"class","space-y-2"),d(V,"class","flex justify-end gap-3 pt-4"),d(_,"class","p-6 space-y-4"),d(t,"class","bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl mx-4"),d(e,"class","fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50")},m(c,I){j(c,e,I),i(e,t),i(t,s),i(s,l),y&&y.m(l,null),i(l,r),i(l,n),i(n,a),i(s,b),i(s,E),i(t,H),i(t,_),i(_,S),i(S,D),i(D,B),i(B,F),i(D,g),i(D,W),i(W,Z),i(W,ae),i(S,ce),i(S,G),i(G,O),i(S,fe),i(S,U),i(U,$),i(U,de),i(_,ue),i(_,q),i(q,L),i(q,he),i(q,P);for(let p=0;p<m.length;p+=1)m[p]&&m[p].m(P,null);i(P,ee),C&&C.m(P,null),i(_,ge),i(_,V),k&&k.m(V,null),i(V,te),w&&w.m(V,null),pe||(ye=ke(E,"click",o[9]),pe=!0)},p(c,[I]){if(c[6]?y&&(y.d(1),y=null):y||(y=xe(),y.c(),y.m(l,r)),I&1&&J(a,c[0]),I&8&&J(F,c[3]),I&16&&X!==(X=Math.floor(c[4])+"")&&J(Z,X),I&4&&Ie(O,"width",c[2]+"%"),I&4&&Y!==(Y=Math.round(c[2])+"")&&J($,Y),I&32){K=De(c[5]);let p;for(p=0;p<K.length;p+=1){const z=Me(c,K,p);m[p]?m[p].p(z,I):(m[p]=Pe(z),m[p].c(),m[p].m(P,ee))}for(;p<m.length;p+=1)m[p].d(1);m.length=K.length}c[5].length===0?C||(C=Ve(),C.c(),C.m(P,null)):C&&(C.d(1),C=null),!c[6]&&c[1]?k?k.p(c,I):(k=Te(c),k.c(),k.m(V,te)):k&&(k.d(1),k=null),c[6]?w?w.p(c,I):(w=Ne(c),w.c(),w.m(V,null)):w&&(w.d(1),w=null)},i:be,o:be,d(c){c&&f(e),y&&y.d(),qe(m,c),C&&C.d(),k&&k.d(),w&&w.d(),pe=!1,ye()}}}function Fe(o,e,t){let s;Ae(o,Oe,g=>t(8,s=g));let{taskId:l}=e,{title:r="Processing..."}=e,{onClose:n}=e,{onStop:a=null}=e,b=0,E="Starting...",A=0,H=[],_=null,S=!1,D=!1;console.log("[ProgressModal] Initialized with onStop:",a!==null),l&&(_=Ue(l,g=>{t(3,E=g.status||"Processing..."),t(4,A=g.elapsed||0),t(2,b=g.progress||Math.min(A*2,95));const W=`[${Math.floor(A)}s] ${E}`;t(5,H=[...H,W]),g.status==="completed"?(t(2,b=100),t(6,S=!0),setTimeout(()=>{_&&_.close(),n()},2e3)):g.status==="failed"&&t(6,S=!0)},g=>{console.error("WebSocket error:",g),t(3,E="Connection error")})),He(()=>{_&&_.close()});function B(){_&&_.close(),n()}const F=async()=>{if(D){console.log("[ProgressModal] Already cancelling, ignoring click");return}t(7,D=!0),console.log("[ProgressModal] Stop button clicked");try{a?(console.log("[ProgressModal] Calling onStop function"),await a(),console.log("[ProgressModal] onStop completed")):console.error("[ProgressModal] onStop is null!")}catch(g){console.error("[ProgressModal] Error in onStop:",g),t(7,D=!1)}};return o.$$set=g=>{"taskId"in g&&t(10,l=g.taskId),"title"in g&&t(0,r=g.title),"onClose"in g&&t(11,n=g.onClose),"onStop"in g&&t(1,a=g.onStop)},[r,a,b,E,A,H,S,D,s,B,l,n,F]}class Xe extends We{constructor(e){super(),je(this,e,Fe,Je,Be,{taskId:10,title:0,onClose:11,onStop:1})}}export{Xe as P};
