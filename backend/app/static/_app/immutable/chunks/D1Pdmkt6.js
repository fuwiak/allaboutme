import{S as xe,i as Te,s as Ne,n as ne,d as f,D as We,b as z,I as Ee,c as W,e as i,f as u,g as h,h as v,k as D,m as T,j as ie,o as g,q as M,t as N,B as je,U as Be,l as me}from"./C5iOHsLH.js";import{e as Se}from"./DfBDX2Lx.js";import"./IHki7fMi.js";import{t as Ue}from"./CncNp5At.js";function qe(r,e,t){const s=`ws://localhost:8000/ws/progress/${r}`,l=new WebSocket(s);return l.onopen=()=>{console.log(`WebSocket connected for task: ${r}`)},l.onmessage=o=>{try{const n=JSON.parse(o.data);e(n),(n.status==="completed"||n.status==="failed")&&setTimeout(()=>l.close(),1e3)}catch(n){console.error("Error parsing WebSocket message:",n)}},l.onerror=o=>{console.error("WebSocket error:",o),t&&t(o)},l.onclose=()=>{console.log(`WebSocket closed for task: ${r}`)},l}function Ce(r,e,t){const s=r.slice();return s[14]=e[t],s}function Ie(r){let e,t='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',s,l;return{c(){e=g("button"),e.innerHTML=t,this.h()},l(o){e=h(o,"BUTTON",{class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-c0ed9w"&&(e.innerHTML=t),this.h()},h(){u(e,"class","text-gray-400 hover:text-white transition-colors")},m(o,n){W(o,e,n),s||(l=me(e,"click",r[9]),s=!0)},p:ne,d(o){o&&f(e),s=!1,l()}}}function De(r){let e,t=r[14]+"",s;return{c(){e=g("div"),s=N(t),this.h()},l(l){e=h(l,"DIV",{class:!0});var o=v(e);s=T(o,t),o.forEach(f),this.h()},h(){u(e,"class","hover:bg-gray-800/50 px-2 py-1 rounded")},m(l,o){W(l,e,o),i(e,s)},p(l,o){o&32&&t!==(t=l[14]+"")&&z(s,t)},d(l){l&&f(e)}}}function Me(r){let e,t="Waiting for updates...";return{c(){e=g("div"),e.textContent=t,this.h()},l(s){e=h(s,"DIV",{class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-1h4wqyt"&&(e.textContent=t),this.h()},h(){u(e,"class","text-gray-500 text-center py-8")},m(s,l){W(s,e,l)},d(s){s&&f(e)}}}function Ve(r){let e,t,s;function l(a,m){return a[7]?He:Ae}let o=l(r),n=o(r);return{c(){e=g("button"),n.c(),this.h()},l(a){e=h(a,"BUTTON",{class:!0});var m=v(e);n.l(m),m.forEach(f),this.h()},h(){e.disabled=r[7],u(e,"class","px-6 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors")},m(a,m){W(a,e,m),n.m(e,null),t||(s=me(e,"click",r[12]),t=!0)},p(a,m){o===(o=l(a))&&n?n.p(a,m):(n.d(1),n=o(a),n&&(n.c(),n.m(e,null))),m&128&&(e.disabled=a[7])},d(a){a&&f(e),n.d(),t=!1,s()}}}function Ae(r){let e,t=r[8]("common.stop")+"",s;return{c(){e=N("⏹️ "),s=N(t)},l(l){e=T(l,"⏹️ "),s=T(l,t)},m(l,o){W(l,e,o),W(l,s,o)},p(l,o){o&256&&t!==(t=l[8]("common.stop")+"")&&z(s,t)},d(l){l&&(f(e),f(s))}}}function He(r){let e,t,s,l=r[8]("common.cancelling")+"",o;return{c(){e=g("span"),t=g("div"),s=M(),o=N(l),this.h()},l(n){e=h(n,"SPAN",{class:!0});var a=v(e);t=h(a,"DIV",{class:!0}),v(t).forEach(f),s=D(a),o=T(a,l),a.forEach(f),this.h()},h(){u(t,"class","animate-spin rounded-full h-4 w-4 border-b-2 border-white"),u(e,"class","flex items-center gap-2")},m(n,a){W(n,e,a),i(e,t),i(e,s),i(e,o)},p(n,a){a&256&&l!==(l=n[8]("common.cancelling")+"")&&z(o,l)},d(n){n&&f(e)}}}function Pe(r){let e,t="Close",s,l;return{c(){e=g("button"),e.textContent=t,this.h()},l(o){e=h(o,"BUTTON",{class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-15mws22"&&(e.textContent=t),this.h()},h(){u(e,"class","px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg transition-colors")},m(o,n){W(o,e,n),s||(l=me(e,"click",r[9]),s=!0)},p:ne,d(o){o&&f(e),s=!1,l()}}}function Oe(r){let e,t,s,l,o,n,a,m,j,B,C,_,I,V,J,R,d,q=Math.floor(r[4])+"",Y,ae,ce,F,A,fe,H,X=Math.round(r[2])+"",Z,de,ue,U,O,be="Detailed Progress:",he,P,$,ge,x,ee,k=r[6]&&Ie(r),G=Se(r[5]),b=[];for(let c=0;c<G.length;c+=1)b[c]=De(Ce(r,G,c));let E=r[5].length===0&&Me(),w=!r[6]&&r[1]&&Ve(r),y=r[6]&&Pe(r);return{c(){e=g("div"),t=g("div"),s=g("div"),l=g("div"),o=g("div"),n=M(),a=g("h2"),m=N(r[0]),j=M(),k&&k.c(),B=M(),C=g("div"),_=g("div"),I=g("div"),V=g("span"),J=N(r[3]),R=M(),d=g("span"),Y=N(q),ae=N("s elapsed"),ce=M(),F=g("div"),A=g("div"),fe=M(),H=g("div"),Z=N(X),de=N("%"),ue=M(),U=g("div"),O=g("h3"),O.textContent=be,he=M(),P=g("div");for(let c=0;c<b.length;c+=1)b[c].c();$=M(),E&&E.c(),ge=M(),x=g("div"),w&&w.c(),ee=M(),y&&y.c(),this.h()},l(c){e=h(c,"DIV",{class:!0});var S=v(e);t=h(S,"DIV",{class:!0});var p=v(t);s=h(p,"DIV",{class:!0});var L=v(s);l=h(L,"DIV",{class:!0});var te=v(l);o=h(te,"DIV",{class:!0}),v(o).forEach(f),n=D(te),a=h(te,"H2",{class:!0});var ke=v(a);m=T(ke,r[0]),ke.forEach(f),te.forEach(f),j=D(L),k&&k.l(L),L.forEach(f),B=D(p),C=h(p,"DIV",{class:!0});var K=v(C);_=h(K,"DIV",{class:!0});var Q=v(_);I=h(Q,"DIV",{class:!0});var le=v(I);V=h(le,"SPAN",{class:!0});var we=v(V);J=T(we,r[3]),we.forEach(f),R=D(le),d=h(le,"SPAN",{class:!0});var pe=v(d);Y=T(pe,q),ae=T(pe,"s elapsed"),pe.forEach(f),le.forEach(f),ce=D(Q),F=h(Q,"DIV",{class:!0});var ye=v(F);A=h(ye,"DIV",{class:!0,style:!0}),v(A).forEach(f),ye.forEach(f),fe=D(Q),H=h(Q,"DIV",{class:!0});var ve=v(H);Z=T(ve,X),de=T(ve,"%"),ve.forEach(f),Q.forEach(f),ue=D(K),U=h(K,"DIV",{class:!0});var se=v(U);O=h(se,"H3",{class:!0,"data-svelte-h":!0}),ie(O)!=="svelte-170owwq"&&(O.textContent=be),he=D(se),P=h(se,"DIV",{class:!0});var oe=v(P);for(let _e=0;_e<b.length;_e+=1)b[_e].l(oe);$=D(oe),E&&E.l(oe),oe.forEach(f),se.forEach(f),ge=D(K),x=h(K,"DIV",{class:!0});var re=v(x);w&&w.l(re),ee=D(re),y&&y.l(re),re.forEach(f),K.forEach(f),p.forEach(f),S.forEach(f),this.h()},h(){u(o,"class","animate-spin rounded-full h-6 w-6 border-b-2 border-purple-500"),u(a,"class","text-xl font-bold text-white"),u(l,"class","flex items-center gap-3"),u(s,"class","flex items-center justify-between p-6 border-b border-gray-700"),u(V,"class","text-gray-300"),u(d,"class","text-gray-400"),u(I,"class","flex justify-between text-sm"),u(A,"class","bg-gradient-to-r from-purple-500 to-blue-500 h-full transition-all duration-300 ease-out"),Ee(A,"width",r[2]+"%"),u(F,"class","w-full bg-gray-700 rounded-full h-3 overflow-hidden"),u(H,"class","text-right text-sm text-gray-400"),u(_,"class","space-y-2"),u(O,"class","text-sm font-semibold text-gray-300"),u(P,"class","bg-black/50 rounded-lg p-4 h-64 overflow-y-auto font-mono text-xs text-gray-300 space-y-1"),u(U,"class","space-y-2"),u(x,"class","flex justify-end gap-3 pt-4"),u(C,"class","p-6 space-y-4"),u(t,"class","bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl mx-4"),u(e,"class","fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50")},m(c,S){W(c,e,S),i(e,t),i(t,s),i(s,l),i(l,o),i(l,n),i(l,a),i(a,m),i(s,j),k&&k.m(s,null),i(t,B),i(t,C),i(C,_),i(_,I),i(I,V),i(V,J),i(I,R),i(I,d),i(d,Y),i(d,ae),i(_,ce),i(_,F),i(F,A),i(_,fe),i(_,H),i(H,Z),i(H,de),i(C,ue),i(C,U),i(U,O),i(U,he),i(U,P);for(let p=0;p<b.length;p+=1)b[p]&&b[p].m(P,null);i(P,$),E&&E.m(P,null),i(C,ge),i(C,x),w&&w.m(x,null),i(x,ee),y&&y.m(x,null)},p(c,[S]){if(S&1&&z(m,c[0]),c[6]?k?k.p(c,S):(k=Ie(c),k.c(),k.m(s,null)):k&&(k.d(1),k=null),S&8&&z(J,c[3]),S&16&&q!==(q=Math.floor(c[4])+"")&&z(Y,q),S&4&&Ee(A,"width",c[2]+"%"),S&4&&X!==(X=Math.round(c[2])+"")&&z(Z,X),S&32){G=Se(c[5]);let p;for(p=0;p<G.length;p+=1){const L=Ce(c,G,p);b[p]?b[p].p(L,S):(b[p]=De(L),b[p].c(),b[p].m(P,$))}for(;p<b.length;p+=1)b[p].d(1);b.length=G.length}c[5].length===0?E||(E=Me(),E.c(),E.m(P,null)):E&&(E.d(1),E=null),!c[6]&&c[1]?w?w.p(c,S):(w=Ve(c),w.c(),w.m(x,ee)):w&&(w.d(1),w=null),c[6]?y?y.p(c,S):(y=Pe(c),y.c(),y.m(x,null)):y&&(y.d(1),y=null)},i:ne,o:ne,d(c){c&&f(e),k&&k.d(),We(b,c),E&&E.d(),w&&w.d(),y&&y.d()}}}function Le(r,e,t){let s;je(r,Ue,d=>t(8,s=d));let{taskId:l}=e,{title:o="Processing..."}=e,{onClose:n}=e,{onStop:a=null}=e,m=0,j="Starting...",B=0,C=[],_=null,I=!1,V=!1;console.log("[ProgressModal] Initialized with onStop:",a!==null),l&&(_=qe(l,d=>{t(3,j=d.status||"Processing..."),t(4,B=d.elapsed||0),t(2,m=d.progress||Math.min(B*2,95));const q=`[${Math.floor(B)}s] ${j}`;t(5,C=[...C,q]),d.status==="completed"?(t(2,m=100),t(6,I=!0),setTimeout(()=>{_&&_.close(),n()},2e3)):d.status==="failed"&&t(6,I=!0)},d=>{console.error("WebSocket error:",d),t(3,j="Connection error")})),Be(()=>{_&&_.close()});function J(){_&&_.close(),n()}const R=async()=>{if(V){console.log("[ProgressModal] Already cancelling, ignoring click");return}t(7,V=!0),console.log("[ProgressModal] Stop button clicked");try{a?(console.log("[ProgressModal] Calling onStop function"),await a(),console.log("[ProgressModal] onStop completed")):console.error("[ProgressModal] onStop is null!")}catch(d){console.error("[ProgressModal] Error in onStop:",d),t(7,V=!1)}};return r.$$set=d=>{"taskId"in d&&t(10,l=d.taskId),"title"in d&&t(0,o=d.title),"onClose"in d&&t(11,n=d.onClose),"onStop"in d&&t(1,a=d.onStop)},[o,a,m,j,B,C,I,V,s,J,l,n,R]}class Ke extends xe{constructor(e){super(),Te(this,e,Le,Oe,Ne,{taskId:10,title:0,onClose:11,onStop:1})}}export{Ke as P};
